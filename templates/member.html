{%extends "layout.html"%}
{% block title %}Students Page{% endblock %}

{% block head %}
<link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">
<link rel="stylesheet" href="{{url_for('static', filename = 'table.css')}}">
{% endblock head %}
{% block current_user %}{{ name[0] }} {{ name[1] }} {% endblock current_user %}    
{%block content%}

<!-- <link href="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.js"></script> -->

<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

    <link href="https://nightly.datatables.net/css/jquery.dataTables.css" rel="stylesheet" type="text/css" />
    <script src="https://nightly.datatables.net/js/jquery.dataTables.js"></script>
	<!-- Select2 plugin -->
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css">
	<!-- Select2 plugin -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>


<script>
    $(document).ready(function(){
      $("#input").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#mytable tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      }); 
    });

  //   $(function() {
  //   $('.multiple-select').multipleSelect()
  // })

     $(document).ready(function () {
     var $rows = $('tbody#mytable tr')
   
      var $filters = $('.table-filter').change(function(){
       var filterArr = $filters.filter(function(){
          return this.value
       }).map(function(){
          var $el = $(this);
          var value = $el.is('select') ? $el.find(':selected').text() :$el.val()  
          return {
            col: $el.data('col'),
            value: value.toLowerCase()
          }
       }).get();
       if(!filterArr.length){
         $rows.show()
       }else{
         $rows.hide().filter(function(){
            var $row = $(this)
            return filterArr.every(function(filterObj, i){
               var cellText = $row.find('td').eq(filterObj.col).text().toLowerCase();             
              return  cellText.includes(filterObj.value);
            })
         }).show()
       }
     })
    });
   
    $(document).ready( function () {
  
  var table = $('#table').DataTable({
            initComplete: function () {
            count = 0;
            this.api().columns().every( function () {
                var title = this.header();
                //replace spaces with dashes
                title = $(title).html().replace(/[\W]/g, '-');
                var column = this;
                var select = $('<select id="' + title + '" class="select2" ></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                      //Get the "text" property from each selected data 
                      //regex escape the value and store in array
                      var data = $.map( $(this).select2('data'), function( value, key ) {
                        return value.text ? '^' + $.fn.dataTable.util.escapeRegex(value.text) + '$' : null;
                                 });
                      
                      //if no data selected use ""
                      if (data.length === 0) {
                        data = [""];
                      }
                      
                      //join array into string with regex or (|)
                      var val = data.join('|');
                      
                      //search for the option(s) selected
                      column
                            .search( val ? val : '', true, false )
                            .draw();
                    } );
 
                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' );
                } );
              
              //use column title as selector and placeholder
              $('#' + title).select2({
                multiple: true,
                closeOnSelect: false,
                placeholder: "Select a " + title
              });
              
              //initially clear select otherwise first option is selected
              $('.select2').val(null).trigger('change');
            } );
        }
  });
} );
</script>



<div class="container-fluid">
  <h1>Student Information List</h1>
    <form action="/member_upload" method="POST" enctype="multipart/form-data">

    <div class="input-group mb-3">
        <label class="input-group-text" for="inputGroupFile01">Upload</label>
        <input type="file" class="form-control" id="inputGroupFile01" required>
        <button class="btn btn-outline-secondary" type="button" id="btn">Submit</button>
      </div>
    </form>
    </br>

  <div name="input group">
    <form method="POST" action="/member_filter">
    <div class="input-group mb-3">
      <label class="input-group-text" for="inputGroupFile01">Search</label>
      <input type="text" class="form-control" id="input" onkeyup="myFunction()">
    </div>
    </div>

    <div class="row">
        <div class="col-md-2">
            <h7>School</h7>
           <select id="schoolfilter" name="schoolfilter" class="table-filter multiple-select" data-col="1" multiple> 
             <option value="">Select one</option>           
              {% for col in school_filter %}
                {% for result in col %}               
                <option value="{{result}}">{{result}}</option>
                {% endfor %}
              {% endfor %}
            </select>
          
        </div>
        <div class="col-md-2">
            <h7>Gender</h7>
            <select id="genderfilter" name="selectd" class="table-filter form-control" data-col="6" >
                <option value="">Select one</option>         
                   <option value="Girl">Girl</option>
                   <option value="Boy">Boy</option>
               </select>
        </div>
        <div class="col-md-2">
            <h7>Age</h7>
            <select id="agefilter" name="agefilter" class="table-filter form-control" data-col="7">
              <option value="">Select one</option> 
              {% for col in member_age %}
                {% for result in col%} 
              <option value="{{result}}">{{result}}</option>
                {% endfor %}
              {% endfor %}
            </select>
        </div>

        <div class="col-md-2">
          <h7>Ethnicity</h7>
          <select id="ethnicityfilter" name="ethnicityfilter" class="table-filter form-control" data-col="8">
            <option value="">Select one</option> 
            {% for col in ethnicity %}
              {% for result in col%} 
              <option value="{{result}}">{{result}}</option>
              {% endfor %}
            {% endfor %}
            </select>
      </div>

      <div class="col-md-2">
        <h7>Continuing/New</h7>
        <select id="filter" name="filter" class="table-filter form-control" data-col="9">
          <option value="">Select one</option> 
          <option value="Continuing">Continuing</option>
          <option value="New">New</option>
        </select>
    </div>
        <div class="col-md-2">
            <h7>Previous Hours</h7>
           <select id="previoushoursfilter" name="previoushoursfilter" class="table-filter form-control"  data-col="11">
            <option value="">Select one</option> 
            {% for col in previous_hours %}
              {% for result in col%} 
              <option value="{{result}}">{{result}}</option>
              {% endfor %}
            {% endfor %}
            </select>
        </div>

        <div class="col-md-3">
          <h7>Passport Date Issued</h7>
          <input type="date" class="form-control" id="datefilterfrom" data-date-split-input="true"  data-col="12">
        </div>

      <div class="col-md-2">
        <h7>Ethnicity Info</h7>
        <select id="ethnicityfilter" name="ethnicityfilter" class="table-filter form-control" data-col="13">
          <option value="">Select one</option> 
          <option value="True">True</option>
          <option value="False">False</option>
        </select>
      </div>

      <div class="col-md-3">
        <h7>Teaching Research</h7>
        <select id="teachfilter" name="teachfilter" class="table-filter form-control" data-col="14">
          <option value="">Select one</option> 
          <option value="True">True</option>
          <option value="False">False</option>
        </select>
      </div>

      <div class="col-md-3">
        <h7>Pubilication Promos</h7>
        <select id="promofilter" name="promofilter" class="table-filter form-control" data-col="15">
          <option value="">Select one</option> 
          <option value="True">True</option>
          <option value="False">False</option>
        </select>
      </div>

      <div class="col-md-2">
        <h7>Social Media</h7>
        <select id="socialfilter" name="socialfilter" class="table-filter form-control" data-col="16">
          <option value="">Select one</option> 
          <option value="True">True</option>
          <option value="False">False</option>
        </select>
      </div>

      <div class="col-md-2">
        <h7>Total Hours</h7>
        <select id="hoursfilter" name="hoursfilter" class="table-filter form-control" data-col="17">
          <option value="">Select one</option>
          {% for col in total_hours %}
            {% for result in col%} 
          <option value="{{result}}">{{result}}</option>
            {% endfor %}
          {% endfor %}
        </select>
        </div>

        <div class="col-md-2">
          <h7>Gown Size</h7>
          <select id="gownfilter" name="gownfilter" class="table-filter form-control" data-col="18">
            <option value="">Select one</option>
            {% for col in gown_size %}
              {% for result in col%} 
            <option value="{{result}}">{{result}}</option>
              {% endfor %}
            {% endfor %}
          </select>
          </div>

          <div class="col-md-2">
            <h7>Hat Size</h7>
            <select id="hatfilter" name="hatfilter" class="table-filter form-control" data-col="19">
              <option value="">Select one</option>
              {% for col in hat_size %}
                {% for result in col%} 
              <option value="{{result}}">{{result}}</option>
                {% endfor %}
              {% endfor %}
            </select>
          </div>

          <div class="col-md-2">
              <h7>Status</h7>
              <select id="statusfilter" name="statusfilter" class="table-filter form-control" data-col="20">
                <option value="">Select one</option>
                {% for col in status%}
                  {% for result in col%} 
                <option value="{{result}}">{{result}}</option>
                  {% endfor %}
                {% endfor %}
              </select>           
          </div>
          <div class="col-md-2">
          </br>
            <button type="reset" id="reset" role="button" class="btn btn-outline-secondary" onclick="window.location.reload()">Reset</button>
            <button type="submit" id="reset" role="button" class="btn btn-outline-secondary" >Submit</button>
          </div>

        </form>
    </div>


    <div class="table-responsive">
    <table class="table table-striped table-hover table-sm" style="font-size: .875rem" id="table">
        <thead>
            <tr>
                <th scope="col">Member ID</th>
                <th scope="col">School Name</th>
                <th scope="col">First Name</th>
                <th scope="col">Last Name</th>
                <th scope="col">Username</th>
                <th scope="col">Password</th>
                <th scope="col">Gender</th>
                <th scope="col">Age</th>
                <th scope="col">Ethnicity</th>
                <th scope="col">Continuing/ New</th>
                <th scope="col">Passport Number</th>
                <th scope="col">Previous Hours</th>
                <th scope="col">Passport Date Issued </th>
                <th scope="col">Ethnicity Info</th>
                <th scope="col">Teaching Research</th>
                <th scope="col">Pubilication Promos</th>
                <th scope="col">Social Media</th>
                {% if date %}
                <th scope="col">{{date}} Total Hours </th>
                {% endif %}
                <th scope="col">Gown Size</th>
                <th scope="col">Hat Size</th>
                <th scope="col">Status</th>
            </tr>
          </thead>
          <tfoot>
            <tr>
                <th>Member ID</th>
                <th>School Name</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Username</th>
                <th>Password</th>
                <th>Gender</th>
                <th>Age</th>
                <th>Ethnicity</th>
                <th>Continuing/ New</th>
                <th>Passport Number</th>
                <th>Previous Hours</th>
                <th>Passport Date Issued </th>
                <th>Ethnicity Info</th>
                <th>Teaching Research</th>
                <th>Pubilication Promos</th>
                <th>Social Media</th>
                {% if date %}
                <th>{{date}} Total Hours </th>
                {% endif %}
                <th>Gown Size</th>
                <th>Hat Size</th>
                <th>Status</th>
            </tr>
          </tfoot>
        <tbody id="mytable">
            {% for item in result %}
            <tr> 
                {% for col in item %}
                <td>{{col}}</td>
                {% endfor %}
            </tr>
            {%endfor%}
        </tbody>
    </table>
    </div>
</div>

{%endblock%}