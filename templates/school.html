{%extends "layout.html"%}
{%block title%}School Page{%endblock%}

{% block head %}
<link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">
<link rel="stylesheet" href="{{url_for('static', filename = 'table.css')}}">
{% endblock head %}
{% block current_user %}{{ name[0] }} {{ name[1] }} {% endblock current_user %}
{%block content%}
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

    <link href="https://nightly.datatables.net/css/jquery.dataTables.css" rel="stylesheet" type="text/css" />
    <script src="https://nightly.datatables.net/js/jquery.dataTables.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>


<script>
     $(document).ready(function () {
          $("#input").on("keyup", function () {
               var value = $(this).val().toLowerCase();
               $("#mytable tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
               });
          });
     });

     $(document).ready(function () {
     var $rows = $('tbody#mytable tr')
   
      var $filters = $('.table-filter').change(function(){
       var filterArr = $filters.filter(function(){
          return this.value
       }).map(function(){
          var $el = $(this);
          var value = $el.is('select') ? $el.find(':selected').text() :$el.val()  
          return {
            col: $el.data('col'),
            value: value.toLowerCase()
          }
       }).get();
       if(!filterArr.length){
         $rows.show()
       }else{
         $rows.hide().filter(function(){
            var $row = $(this)
            return filterArr.every(function(filterObj, i){
               var cellText = $row.find('td').eq(filterObj.col).text().toLowerCase();             
              return  cellText.includes(filterObj.value);
            })
         }).show()
       }
     })
    });
   
    $(document).ready( function () {
  
  var table = $('#table').DataTable({
            initComplete: function () {
            count = 0;
            this.api().columns().every( function () {
                var title = this.header();
                //replace spaces with dashes
                title = $(title).html().replace(/[\W]/g, '-');
                var column = this;
                var select = $('<select id="' + title + '" class="select2" ></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                      //Get the "text" property from each selected data 
                      //regex escape the value and store in array
                      var data = $.map( $(this).select2('data'), function( value, key ) {
                        return value.text ? '^' + $.fn.dataTable.util.escapeRegex(value.text) + '$' : null;
                                 });
                      
                      //if no data selected use ""
                      if (data.length === 0) {
                        data = [""];
                      }
                      
                      //join array into string with regex or (|)
                      var val = data.join('|');
                      
                      //search for the option(s) selected
                      column
                            .search( val ? val : '', true, false )
                            .draw();
                    } );
 
                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' );
                } );
              
              //use column title as selector and placeholder
              $('#' + title).select2({
                multiple: true,
                closeOnSelect: false,
                placeholder: "Select a " + title
              });
              
              //initially clear select otherwise first option is selected
              $('.select2').val(null).trigger('change');
            } );
        }
  });
} );


</script>


<div class="container-fluid">
     <h1>School Information List</h1>
     <form action="/school_upload" method="POST" enctype="multipart/form-data">

          <div class="input-group mb-3">
            <label class="input-group-text" for="inputGroupFile01">Upload</label>
            <input type="file" class="form-control" id="inputGroupFile01" required>
            <button class="btn btn-outline-secondary" type="submit" id="btn">Submit</button>
            
          </div>
        </form>
        </br>

        <div name="input group">
          <form method="POST" action="/school_filter">
            <div class="input-group mb-3">
              <label class="input-group-text" for="inputGroupFile01">Search</label>
              <input type="text" class="form-control" id="input" onkeyup="myFunction()">
            </div>
        </div>
        
     <div class="row">
          <div class="col-md-2">
               <h4>School</h4>
               <select id="schoolfilter" name="schoolfilter" class="table-filter form-control" data-col="1" multiple>
                    <option value="">Select one</option>
                    {% for col in school_filter %}
                    {% for result in col%}
                    <option value="{{result}}">{{result}}</option>
                    {% endfor %}
                    {% endfor %}
               </select>

     </div>
          <div class="col-md-3">
               <h4>Who</h4>
               <select id="genderfilter" name="genderfilter" class="table-filter form-control">
                    <option value="">Select one</option>
                    <option value="Jack">Jack</option>
                    
               </select>
          </div>
          <div class="col-md-3">
               <h4>Council</h4>
               <input type="text" class="form-control" id="table-filter form-control">
          </div>
          <div class="col-md-3">
               <h4>Category</h4>
               <input type="text" class="form-control" id="table-filter form-control">
          </div>
          <div class="col-md-2">
               <h4>Status</h4>
               <select id="servicefilter" name="servicefilter" class="table-filter form-control" data-col="3">
                    <option value="">Select one</option>
                    <option value="1">Active</option>
                    <option value="2">Inactive</option>
               </select>

          <div class="col-md-2">
          </br>
          <button type="reset" id="reset" role="button" class="btn btn-outline-secondary"
            onclick="window.location.reload()">Reset</button>
          <button type="submit" id="reset" role="button" class="btn btn-outline-secondary">Submit</button>
        </div>
     </div>
     <div class="table-responsive">
          <table class="table table-striped table-hover table-sm" style="font-size: .875rem">
          <thead>
               <tr>
                    <th scope="col">School ID</th>
                    <th scope="col">School Name</th>
                    <th scope="col">Who</th>
                    <th scope="col">Council</th>
                    <th scope="col">Category</th>
                    <th scope="col">Status</th>
                    <th scope="col">Returning Number</th>
                    <th scope="col">Max Number 2021</th>
                    <th scope="col">Confirmed Number</th>
                    <th scope="col">Coordinator ID</th>
                    <th scope="col">Training</th>
                    <th scope="col">Launch</th>
                    <th scope="col">Passport Presentation</th>
                    <th scope="col">Portal</th>
                    <th scope="col">Passports</th>
                    <th scope="col">Agreement</th>
                    <th scope="col">Consent</th>
                    <th scope="col">Notes</th>
               </tr>
          </thead>
          <tfoot>
               <tr>
                    <th>School ID</th>
                    <th>School Name</th>
                    <th>Who</th>
                    <th>Council</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Returning Number</th>
                    <th>Max Number 2021</th>
                    <th>Confirmed Number</th>
                    <th>Coordinator ID</th>
                    <th>Training</th>
                    <th>Launch</th>
                    <th>Passport Presentation</th>
                    <th>Portal</th>
                    <th>Passports</th>
                    <th>Agreement</th>
                    <th>Consent</th>
                    <th>Notes</th>    
               </tr>
          </tfoot>
          <tbody id="mytable">
               {% for item in result %}
               <tr>
                    {% for col in item %}
                    <td>{{col}}</td>
                    {% endfor %}
               </tr>
               {%endfor%}
          </tbody>
     </table>
     </div>
</div>

{%endblock%}